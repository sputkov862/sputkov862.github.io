

## ==Модульная структура==


```mermaid
graph TB
    subgraph "Презент слой"
        CLI
    end
    
    subgraph "Бизнес-логика"
        CONFIG[Configuration Manager]
        WALLET[Wallet Generator]
        META[Metadata Manager]
        BUNDLER[Bundle Constructor]
    end
    
    subgraph "Интеграционный слой"
        PUMP[Pump.fun Client]
        JITO[Jito Client]
        IPFS[IPFS Client]
        RPC[Solana RPC]
    end
    
    subgraph "Инфраструктура"
        LUT[Lookup Tables]
        KEYS[Key Management]
        LOG[Logging System]
    end
    
    CLI --> CONFIG
    UI --> CONFIG
    CONFIG --> WALLET
    CONFIG --> META
    WALLET --> LUT
    META --> IPFS
    BUNDLER --> PUMP
    BUNDLER --> JITO
    PUMP --> RPC
    JITO --> RPC
    LUT --> KEYS
```

---

## Детализация модулей

### Configuration Manager
**Назначение**: Централизованное управление настройками и константами

```mermaid
graph LR
    ENV[.env файл] --> CONFIG[Configuration Manager]
    CONFIG --> RPC[RPC Settings]
    CONFIG --> ENDPOINTS[Service Endpoints]
    CONFIG --> KEYS[Key Paths]
    CONFIG --> PARAMS[Default Parameters]
```

**Ключевые константы**:
- Pump.fun программы и аккаунты
- Jito Block Engine эндпоинты
- RPC провайдеры и fallback URLs
- Настройки таймаутов и retry логики

### Wallet Management System
**Назначение**: Генерация и управление множественными кошельками

```mermaid
graph TD
    A[Wallet Generator] --> B[Generate Keypairs]
    B --> C[Distribute SOL]
    C --> D[Create LUT Entries]
    D --> E[Save to keyInfo.json]
    
    E --> F[Developer Wallet]
    E --> G[Buyer Wallets 1-16]
    E --> H[LUT Address]
```

**Структура данных**:
- Основной кошелек разработчика
- 16 покупательских кошелька с индивидуальными балансами
- Address Lookup Table для оптимизации транзакций
- Планы покупок и распределение объемов

### Pump.fun Integration Layer
**Назначение**: Взаимодействие с Pump.fun смарт-контрактом

```mermaid
sequenceDiagram
    participant CLIENT as Pump.fun Client
    participant IDL as Contract IDL
    participant PDA as PDA Calculator
    participant TX as Transaction Builder
    
    CLIENT->>IDL: Load contract interface
    CLIENT->>PDA: Calculate bonding curve
    CLIENT->>PDA: Calculate metadata account
    CLIENT->>TX: Build create instruction
    CLIENT->>TX: Build buy instructions
```

**Функциональность**:
- Загрузка и парсинг IDL контракта
- Вычисление Program Derived Addresses (PDA)
- Построение инструкций создания и покупки токенов
- Интеграция с Anchor framework

### Jito Bundle Engine
**Назначение**: Отправка bundle транзакций через Jito Block Engine

```mermaid
graph LR
    A[Bundle Constructor] --> B[Transaction Validation]
    B --> C[Tip Addition]
    C --> D[gRPC Client]
    D --> E[Block Engine]
    E --> F[Bundle Status]
```

**Аспекты**:
- Авторизация через keypair
- Добавление tip транзакций для приоритизации
- Мониторинг статуса bundle выполнения
- Обработка ошибок и retry механизмы

### Metadata Management
**Назначение**: Загрузка метаданных токена в IPFS

```mermaid
graph TD
    A[Image Upload] --> B[IPFS Pin]
    B --> C[Get Image URI]
    C --> D[Metadata JSON]
    D --> E[Upload Metadata]
    E --> F[Get Metadata URI]
```

**Интеграции**:
- Pinata IPFS для загрузки изображений
- Формирование JSON метаданных по стандарту SPL Token
- Валидация размеров и форматов файлов

---

## Потоки данных

### Основной поток создания токена

```mermaid
sequenceDiagram
    participant USER as User
    participant CLI as CLI Interface
    participant CONFIG as Config Manager
    participant WALLET as Wallet Manager
    participant META as Metadata Manager
    participant BUNDLE as Bundle Constructor
    participant JITO as Jito Client
    participant PUMP as Pump.fun Client
    
    USER->>CLI: Launch token command
    CLI->>CONFIG: Load configuration
    CLI->>WALLET: Load wallet data
    CLI->>META: Upload token metadata
    META-->>CLI: Return metadata URI
    
    CLI->>BUNDLE: Construct bundle
    BUNDLE->>PUMP: Create token instruction
    BUNDLE->>PUMP: Generate buy instructions
    BUNDLE->>JITO: Prepare bundle transactions
    
    JITO->>JITO: Add tip transactions
    JITO->>JITO: Send to Block Engine
    JITO-->>CLI: Return bundle status
```

### Поток обработки ошибок

```mermaid
graph TD
    A[Transaction Failed] --> B{Error Type?}
    B -->|Network| C[Retry with backoff]
    B -->|Validation| D[Log error details]
    B -->|Balance| E[Check wallet balances]
    B -->|RPC| F[Switch RPC endpoint]
    
    C --> G[Max retries reached?]
    G -->|No| A
    G -->|Yes| H[Fail with error]
    
    D --> H
    E --> I[Redistribute SOL]
    F --> A
```

## Связанные документы

- [[01-Техническое-задание]] - Общие требования
- [[03-Процессы-и-алгоритмы]] - Детальная логика работы
- [[Архитектурные-диаграммы]] - Визуальные схемы
- [[Схемы-данных]] - Форматы и структуры
